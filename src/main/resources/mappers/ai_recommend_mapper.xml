<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.triple_stack.route_in_backend.mapper.AIRecommend">
    <resultMap id="AIResultMap" type="com.triple_stack.route_in_backend.dto.Gemini.AIRecommendReqDto">
        <id column="user_id" property="userId" />
        <association property="userProfile" javaType="com.triple_stack.route_in_backend.dto.Gemini.AIRecommendReqDto$UserProfileDto">
            <result column="birth_date" property="birthDate"/>
            <result column="gender" property="gender"/>
        </association>

        <association property="bodyInfo" javaType="com.triple_stack.route_in_backend.dto.Gemini.AIRecommendReqDto$BodyInfoDto">
            <result column="height" property="height"/>
            <result column="weight" property="weight"/>
            <result column="skeletal_muscle" property="skeletalMuscleMass"/>
            <result column="body_fat_mass" property="bodyFatMass" />
            <result column="month_dt" property="monthDt" />
        </association>

        <association property="location" javaType="com.triple_stack.route_in_backend.dto.Gemini.AIRecommendReqDto$LocationDto">
            <result column="zip_code" property="zipCode"/>
            <result column="lat" property="lat"/>
            <result column="lng" property="lng"/>
        </association>

        <association property="workoutHistory" javaType="com.triple_stack.route_in_backend.dto.Gemini.AIRecommendReqDto$WorkoutHistoryDto">
            <result column="current_run" property="currentRun"/>
            <result column="weekly_run" property="weeklyRun"/>
            <result column="exercise" property="exercise"/>
            <result column="weekday" property="weekday" />
        </association>

        <collection property="course" resultMap="CourseResultMap" />
    </resultMap>

    <resultMap id="CourseResultMap" type="com.triple_stack.route_in_backend.entity.Course">
        <id property="courseId" column="course_id"/>
        <result property="userId" column="user_id"/>
        <result property="boardId" column="board_id"/>
        <result property="courseName" column="course_name"/>
        <result property="distanceM" column="distance_m"/>
        <result property="centerLat" column="center_lat"/>
        <result property="centerLng" column="center_lng"/>
        <result property="region" column="region"/>
        <result property="favorite" column="favorite"/>
        <result property="createDt" column="create_dt"/>
        <result property="updateDt" column="update_dt"/>
    </resultMap>

    <select id="getAIContext" resultMap="AIResultMap">
        select
            ut.birth_date,
            ut.gender,
            ut.height,
            ut.weight,
            it.skeletal_muscle_mass,
            it.body_fat_mass,
            it.month_dt,
            at.zip_code,
            cpt.lat,
            cpt.lng,
            ut.current_run,
            ut.weekly_run,
            rt.exercise,
            rt.weekday,
            ct.*
        from
            user_tb ut
            join in_body_tb it on (ut.user_id = it.user_id)
            join address_tb at on (it.user_id = at.user_id)
            join routine_tb rt on (at.user_id = rt.user_id)
            join course_tb ct on (rt.user_id = ct.user_id)
            join course_point_tb cpt on (ct.course_id = cpt.course_id)
        where
            ut.user_id = #{userId}
    </select>
</mapper>